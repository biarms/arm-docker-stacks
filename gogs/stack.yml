version: '3.4'

services:
  gogs:
    image: ${DOCKER_REGISTRY}gogs/gogs-rpi
    volumes:
     - gogs-data:/data
    ports:
     - 10022:22
     - 33000:3000
    deploy:
      replicas: 1

  gogs-postgres:
    image: ${DOCKER_REGISTRY}postgres:12.3-alpine
    environment:
      POSTGRES_USER: gogs
      POSTGRES_PASSWORD_FILE: /run/secrets/gogs-db-password
      POSTGRES_DB: gogs
    volumes:
     - gogs-db-data:/var/lib/postgresql/data
    ports:
      - 5432
    secrets:
     - gogs-db-password
    deploy:
      replicas: 1

  gogs-db-admin:
    image: ${DOCKER_REGISTRY}biarms/pgadmin4:2.1
    volumes:
     - gogs-pgadmin-data:/pgadmin
    ports:
     - 35050:5050
    deploy:
      replicas: 0

volumes:
  gogs-data:
  gogs-db-data:
  gogs-pgadmin-data:

secrets:
  gogs-db-password:
    file: db-password.txt